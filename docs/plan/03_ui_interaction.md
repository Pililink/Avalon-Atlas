# GUI 界面与交互设计

## 1. 布局结构
```
┌───────────────────────────────┐
│ 搜索输入框  | 查询 | 清除      │  (工具栏层)
├───────────────────────────────┤
│ 结果列表（可滚动，多选单选）  │  (列表层)
├───────────────────────────────┤
│ 选中地图详情展示区            │  (详情层)
└───────────────────────────────┘
```
- 使用 `QVBoxLayout` 垂直排列三个区域。
- 顶部工具栏使用 `QHBoxLayout`：包含 `QLineEdit`、`QPushButton`（查询）、`QPushButton`（清除）、状态提示 `QLabel`。
- 列表区域采用 `QListWidget`/`QListView+QAbstractListModel`，支持键盘上下选择、双击。
- 底部详情区使用 `QTextEdit`（只读）或 `QGroupBox+栅格布局` 展示地图信息、历史、操作按钮。

## 2. 交互流程
1. 用户输入关键字 → `returnPressed` 或点击查询 → 调 `trigger_search()`（200ms debounce）。
2. `trigger_search()` 调 `SearchService` 返回按得分排序的完整结果 → 列表刷新，列表可滚动以浏览所有命中项。
3. 列表有选择变化 → `on_selection_changed()` 更新详情区。
4. 清除按钮 → 清空输入、结果、详情，同时重置状态提示。
5. 热键触发 OCR → Qt Signal `hotkey_text_received` → 输入框填入文字 → 自动执行查询。
6. 列表项双击 → 将地图名称复制到剪贴板并高亮详情；也可打开外部链接（如地图攻略）。

## 3. 组件逻辑与状态
- **输入框 (`search_input`)**：
  - Placeholder 显示“输入地图名/热键 Ctrl+Alt+M OCR”。
  - 支持历史下拉（`QCompleter`）或记忆最近查询。
- **结果列表 (`results_list`)**：
  - 每个 `QListWidgetItem` 显示缩略信息：左侧加载 `static/maps/{name}.webp/png` 的缩略图，中间为地图名称与匹配标签，右侧展示关键资源概览（例如石/木/矿等以图标+数字表示），便于快速判断。
  - OCR 识别的结果会被自动置顶并高亮，仍以同样的缩略卡片方式呈现。
  - 空结果显示占位文本“未找到匹配项”。
- **详情区 (`detail_panel`)**：
  - 点击列表项后在详情区展示全尺寸地图图像与完整信息：`tier`, `map_type`, `chests`, `dungeons`, `resources`, `brecilien` 等。
  - 提供按钮：复制名称、打开地图资料、复制资源概览。
- **状态提示**：
  - 成功 OCR 显示“识别为 xxx”；
  - 错误时显示“OCR 失败/未识别”，颜色提示。

## 4. 热键与系统托盘
- 可选：在 `QSystemTrayIcon` 中提供“隐藏/显示窗口”“退出”快速操作。
- 热键默认 `Ctrl+Alt+M`，在配置中可修改。
- 托盘提示 OCR 状态，防止窗口被遮挡时用户不知进度。

## 5. 交互细节
- 输入框内容变化时延迟触发（200ms debounce）→ 实现即时搜索但避免频繁调用；结果列表可滚动显示全部匹配，不再限制 Top 5。
- 支持键盘快捷键：
  - `Esc` 清除输入。
  - `Enter` 在列表具有焦点时执行复制。
- 列表保持滚动位置：新结果自动滚动到顶部，但若用户正在浏览，可保持位置。
- 详情区若数据为空，显示提示文字；选中项切换时淡入动画（可选）。

## 6. 无障碍与国际化
- 所有控件设置 `accessibleName`。
- 通过 `QTranslator` 准备后期多语言支持（中文/英文）。

## 7. 可视元素
- 颜色主题与按钮状态统一（Qt StyleSheet）。
- 列表项命中标签使用圆角背景，快速识别匹配方式。
- OCR/热键提示使用顶部细条或状态栏，不打断用户操作。
